---
# =============================================================================
# CDX-E Playbook: Vulnerability Deployment
# =============================================================================
# Purpose: Deploy insecure applications and vulnerable OS/service
#          configurations to designated hosts per the scenario specification.
#          Supports Red Team objectives and Blue Team detection training.
#
# Roles:
#   - deploy_vulnerability
#
# Usage:
#   ansible-playbook playbooks/vulnerability_deployment.yml \
#     -e "exercise=OBSIDIAN_DAGGER" \
#     -e "@secrets/credentials.yml"
#
# WARNING: This playbook intentionally introduces security weaknesses.
#          Only run against isolated CDX range hosts.
# =============================================================================

- name: Vulnerability Deployment
  hosts: exercise_hosts
  gather_facts: false
  tags: [vulnerabilities, red_team]

  vars_files:
    - "{{ playbook_dir }}/secrets/credentials.yml"

  pre_tasks:
    - name: "[preflight] Skip - vulnerabilities phase disabled in scenario"
      ansible.builtin.meta: end_play
      when: not (scenario.phases.vulnerabilities | default(false) | bool)

  roles:
    - deploy_vulnerability
