;=============================================================================
; SQL Server Unattended Configuration File
; Generated by CDX-E deploy_sql_server role
; Exercise : {{ scenario.exercise.name | default('CDX-E') }}
; Host     : {{ inventory_hostname }}
;=============================================================================

[OPTIONS]

; Core action
ACTION                    = "Install"
QUIET                     = "True"
QUIETSIMPLE               = "False"

; Update behaviour (disabled — offline training environment)
UpdateEnabled             = "False"
UpdateSource              = "MU"

; Features to install
FEATURES                  = {{ sql_features }}

; Instance configuration
INSTANCENAME              = "{{ sql_instance_name }}"
{% if sql_instance_dir %}
INSTANCEDIR               = "{{ sql_instance_dir }}"
{% endif %}

; Service startup types
SQLSVCSTARTUPTYPE         = "Automatic"
AGTSVCSTARTUPTYPE         = "Automatic"
BROWSERSVCSTARTUPTYPE     = "Automatic"

; SQL Server service account
SQLSVCACCOUNT             = "{{ sql_svc_account }}"
{% if sql_svc_password %}
SQLSVCPASSWORD            = "{{ sql_svc_password }}"
{% endif %}

; SQL Server Agent service account
AGTSVCACCOUNT             = "{{ sql_agent_account }}"
{% if sql_agent_password %}
AGTSVCPASSWORD            = "{{ sql_agent_password }}"
{% endif %}

; Sysadmin accounts (Windows principals granted sysadmin role)
{% set admin_list = sql_sysadmin_accounts | map('regex_replace', '(.*)', '"\1"') | join(' ') %}
SQLSYSADMINACCOUNTS       = {{ admin_list }}

; Authentication mode
{% if sql_auth_mode | upper == 'MIXED' %}
SECURITYMODE              = "SQL"
SAPWD                     = "{{ sql_sa_password }}"
{% endif %}
; Windows-only mode: omit SECURITYMODE and SAPWD (default when sql_auth_mode != Mixed)

; Network protocols — TCP enabled, named pipes disabled
TCPENABLED                = "1"
NPENABLED                 = "0"

; Data directory overrides (blank = SQL Server defaults under INSTANCEDIR)
{% if sql_data_dir %}
SQLUSERDBDIR              = "{{ sql_data_dir }}"
{% endif %}
{% if sql_log_dir %}
SQLUSERDBLOGDIR           = "{{ sql_log_dir }}"
{% endif %}
{% if sql_tempdb_dir %}
SQLTEMPDBDIR              = "{{ sql_tempdb_dir }}"
SQLTEMPDBLOGDIR           = "{{ sql_tempdb_dir }}"
{% endif %}
{% if sql_backup_dir %}
SQLBACKUPDIR              = "{{ sql_backup_dir }}"
{% endif %}

; Telemetry — disabled in training environment
SQMREPORTING              = "False"
ERRORREPORTING            = "False"

; Licence acceptance — required for unattended install
IACCEPTSQLSERVERLICENSETERMS = "True"
ENU                          = "True"
