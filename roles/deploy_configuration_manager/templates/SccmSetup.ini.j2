; =============================================================================
; SCCM / Configuration Manager Unattended Setup Script
; Generated by CDX-E deploy_configuration_manager role
; Exercise  : {{ scenario.exercise.name | default('CDX-E') }}
; Host      : {{ inventory_hostname }}
; Site Code : {{ sccm_site_code }}
; =============================================================================

[Identification]
Action=InstallPrimarySite

[Options]
; Use EVAL for training/lab environments; replace with a volume licence key
; for production or accredited exercises.
ProductID={{ sccm_product_id }}

SiteCode={{ sccm_site_code }}
SiteName={{ sccm_site_name }}
SMSInstallDir={{ sccm_install_dir }}

; SDK / WMI provider server — same host for a single-server deployment
SDKServer={{ inventory_hostname }}.{{ scenario.domain.name }}

; HTTP and HTTPS both accepted; PKI not required for training
RoleCommunicationProtocol=HTTPorHTTPS
ClientsUsePKICertificate=0

; Prerequisites
; PrerequisiteComp=1 → use locally staged prereqs at PrerequisitePath
; PrerequisiteComp=0 → SCCM downloads from the internet (requires connectivity)
PrerequisiteComp={{ '1' if sccm_prereqs_path | length > 0 else '0' }}
{% if sccm_prereqs_path | length > 0 %}
PrerequisitePath={{ sccm_prereqs_path }}
{% endif %}

MobileDeviceLanguage=0

; Management Point (MP) — client policy and content location service
ManagementPoint={{ sccm_management_point }}
ManagementPointProtocol={{ sccm_mp_protocol }}

; Distribution Point (DP) — content hosting
DistributionPoint={{ sccm_distribution_point }}
DistributionPointProtocol={{ sccm_dp_protocol }}
DistributionPointInstallIIS={{ '1' if sccm_dp_install_iis | bool else '0' }}

; Install the Configuration Manager console on this server
AdminConsole=1

; Customer Improvement Programme — disabled for offline training range
JoinCEIP=0

[SQLConfigOptions]
; SQL Server connection string:
;   Default instance : SERVERNAME
;   Named instance   : SERVERNAME\INSTANCENAME
SQLServerName={{ _sccm_sql_connection }}

; Site database name — CM_<SiteCode> is the Microsoft convention
DatabaseName={{ sccm_sql_database }}

; SQL Server Service Broker port (default: 4022)
SQLSSBPort={{ sccm_sql_ssb_port }}

{% if sccm_sql_data_path | length > 0 %}
SQLDataFilePath={{ sccm_sql_data_path }}
{% endif %}
{% if sccm_sql_log_path | length > 0 %}
SQLLogFilePath={{ sccm_sql_log_path }}
{% endif %}

[CloudConnectorOptions]
UseProxy=0
ProxyName=
ProxyPort=

[SystemCenterOptions]

[AddServerRoles]
