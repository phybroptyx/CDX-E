configure

########################################
# System Identity / Base Services
########################################

set system host-name 'STK-HQ-SDP-1'
set system domain-name 'stark-industries.midgard.mrvl'
set system time-zone 'America/New_York'

set service ntp server '46.244.164.88'
set service ssh port '22'

########################################
# Interfaces
# eth0: Management (pre-configured, do NOT touch here)
########################################

# eth1: Internal Boundary to HQ Core Router (STK-HQ-CORE)
set interfaces ethernet eth1 description 'Boundary to STK-HQ-CORE'
set interfaces ethernet eth1 address '192.168.203.1/30'

# eth2: External interface with sub-interfaces for DMZ and CDX-I
set interfaces ethernet eth2 description 'External and DMZ'

# eth2 base interface: CDX-I uplink (untagged)
set interfaces ethernet eth2 address '66.218.176.26/20'

# eth2.1102: DMZ gateway (VLAN 1102)
set interfaces ethernet eth2 vif 1102 description 'HQ DMZ'
set interfaces ethernet eth2 vif 1102 address '66.218.179.1/24'

########################################
# Static Routing
########################################

# Default route to the upstream Tier-1 router (CDX-I)
set protocols static route 0.0.0.0/0 next-hop '66.218.176.25'

# Summary route for all HQ internal subnets behind STK-HQ-CORE
# (66.218.180.0/22 encompasses all internal /26 subnets)
set protocols static route 66.218.180.0/22 next-hop '192.168.203.2'

########################################
# OSPF – "Public Internet" View Only
# - OSPF only on external segment (Area 5, matches Toronto T1)
# - Redistribute ONLY the Stark HQ public summary into OSPF
# - No RFC1918 (192.168.203.0/30) leaked into the Internet LSDB
########################################

# Use external IP as OSPF router-id for clarity
set protocols ospf parameters router-id '66.218.176.26'

# Enable OSPF on the external link toward CDX-IXP-T1-EQIX-5 in Area 5
set protocols ospf area 5 network '66.218.176.0/20'

# Policy: only advertise the HQ internal /22 summary into OSPF
# (DMZ 66.218.179.0/24 is NOT advertised - internal use only)

# Prefix-list to match HQ internal summary
set policy prefix-list HQ-INTERNAL-SUMMARY rule 10 action 'permit'
set policy prefix-list HQ-INTERNAL-SUMMARY rule 10 prefix '66.218.180.0/22'

# Route-map to redistribute static routes into OSPF (only HQ internal)
set policy route-map OSPF-EXPORT rule 10 action 'permit'
set policy route-map OSPF-EXPORT rule 10 match ip address prefix-list 'HQ-INTERNAL-SUMMARY'

# Apply route-map to OSPF redistribution
set protocols ospf redistribute static route-map 'OSPF-EXPORT'

########################################
# Firewall / Security Policies
########################################

# TO BE CONFIGURED: Firewall zones and policies
# - Zone: INTERNAL (eth1 - 192.168.203.0/30)
# - Zone: DMZ (eth2.1102 - 66.218.179.0/24)
# - Zone: EXTERNAL (eth2 - 66.218.176.0/20)
#
# Policy examples:
# - INTERNAL → DMZ: Controlled access
# - INTERNAL → EXTERNAL: NAT if needed, policy-based
# - DMZ → INTERNAL: Deny (or very restricted)
# - DMZ → EXTERNAL: Allowed for specific services
# - EXTERNAL → DMZ: Allowed for published services
# - EXTERNAL → INTERNAL: Deny

########################################
# NAT Configuration (if required)
########################################

# TO BE CONFIGURED: Source NAT for internal networks
# Example:
# set nat source rule 100 outbound-interface 'eth2'
# set nat source rule 100 source address '66.218.180.0/22'
# set nat source rule 100 translation address 'masquerade'

########################################
# Configuration Notes
########################################

# This is the Service Demarcation Point (SDP) for HQ
# Primary security boundary between:
# - Internal networks (via STK-HQ-CORE)
# - DMZ (via eth2.1102 VLAN 1102)
# - External/Internet (via eth2 untagged to CDX-I)
#
# Routing Summary:
# - 66.218.180.0/22 → 192.168.203.2 (all internal networks)
# - 66.218.179.0/24 → Direct (DMZ on eth2.1102)
# - 0.0.0.0/0 → 66.218.176.25 (default to CDX-I)
#
# OSPF:
# - Participates in Area 5 (Toronto IXP region)
# - Advertises HQ internal summary (66.218.180.0/22) only
# - Does NOT advertise DMZ or boundary networks
#
# Security:
# - Firewall policies enforce zone-based security
# - All traffic between zones inspected and controlled
# - DMZ isolated from internal networks

commit
save
exit
